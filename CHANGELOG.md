# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.3.1] - 2025-10-25

### Fixed
- **CRITICAL**: PHPDoc `@param` array types in constructor parameters are now properly parsed
  - `@param array<UserDTO> $users` now generates `users: UserDTO[]` instead of `users: any[]`
  - `@param array<string, int> $scores` now generates `scores: Record<string, number>` instead of `scores: any[]`
  - `@param array<string>|null $tags` now generates `tags: string[] | null` instead of `tags: any[] | null`
- **CRITICAL**: `generateWithDependencies()` now correctly generates all nested class dependencies
  - Previously only generated the main class, now generates all referenced classes
  - Dependencies from complex array types are now tracked and generated
  - Constructor parameter array types now trigger dependency generation
- Nullable modifier is now preserved when using complex array types

### Changed
- `ClassAnalyzer` now reads constructor docblock for `@param` tags
- `extractParamDocComment()` improved regex to handle spaces in complex types
- `extractComplexArrayType()` now looks for both `@var` and `@param` tags
- `extractArrayItemType()` now handles `array<Type>` syntax from `@param` tags
- `extractDependencies()` now extracts class names from complex array types
- `TwigExtension` applies nullable mapping to complex array types

### Added
- New method `extractParamDocComment()` to extract `@param` tags for properties
- New method `extractClassNamesFromComplexType()` to find dependencies in complex arrays
- 3 new integration tests with snapshot coverage
- Bug verification script to confirm fixes

### Tests
- 76 tests passing (1 known issue with nested shaped arrays remains)
- New fixtures: `ConstructorParamArrayDTO`, `NestedDependencyDTO`
- New test: `ConstructorParamArrayTest` with 3 test cases

## [1.3.0] - 2025-10-25

### Added
- `#[Exclude]` attribute to exclude properties from TypeScript generation
- Complex PHPDoc array type support:
  - `array{foo: int, bar: string}` → `{ foo: number; bar: string }` (shaped arrays)
  - `array<string, int>` → `Record<string, number>` (generic key-value arrays)
  - `array<string>` → `string[]` (generic single-type arrays)
  - Optional fields: `array{id: int, name?: string}` → `{ id: number; name?: string }`
  - Nullable fields: `array{email: string|null}` → `{ email: string | null }`
- ComplexArrayTypeParser for parsing complex array types
- 16 new tests (75 total tests, 233 assertions)
- New fixtures: ShapedArrayDTO, GenericArrayDTO, ExcludeAttributeDTO, ExcludeClassPropertyDTO

### Changed
- PropertyInfo now includes complexArrayType field
- ClassAnalyzer skips properties with #[Exclude] attribute
- TwigExtension checks for complex array types before regular mapping

### Known Issues
- Nested shaped arrays (e.g., `array{user: array{id: int}}`) partially supported (1 test failing)

## [1.2.0] - 2025-10-25

### Added
- Support for regular class properties (not just constructor properties)
- Int enum support: numeric values without quotes in TypeScript enums
- PHPDoc tag preservation: `@deprecated`, `@see`, `@link`, `@example`, `@var`
- 25 new tests for class properties, comprehensive generation, and PHPDoc support
- Comprehensive test fixtures: ProjectDTO, TaskDTO, RoleEnum, PriorityEnum

### Fixed
- Int enums now generate without quotes (e.g., `LOW = 1` instead of `LOW = '1'`)
- Methods are always omitted from TypeScript interfaces
- PHPDoc comments with useful tags are now preserved in generated TypeScript

### Changed
- Improved doc comment extraction to preserve TypeScript-relevant tags
- Enhanced enum generation template to handle string vs int backing types

## [1.1.0] - 2025-10-25

### Changed
- **BREAKING**: Nested class dependencies are now generated by default (previously required `--with-dependencies` flag)
- CLI now automatically creates separate TypeScript files for all nested classes
- Generated files will overwrite existing TypeScript files

### Added
- `--no-dependencies` flag to disable automatic nested class generation
- Duplicate class tracking to avoid generating the same file multiple times within a single run
- 11 new tests for nested generation and duplicate tracking behavior

### Removed
- `--with-dependencies` flag (now default behavior, use `--no-dependencies` to disable)

### Fixed
- Nested classes are now always generated in separate files
- Duplicate classes are tracked to prevent generating the same file twice in a single run

## [1.0.0] - 2025-10-25

### Added
- Initial release of PHP to TypeScript Generator
- Support for converting PHP DTO classes to TypeScript interfaces
- Support for nested classes with automatic dependency resolution
- Support for PHP 8.1+ enums conversion to TypeScript enums
- Support for typed arrays (e.g., `string[]`, `CustomDTO[]`)
- Support for nullable types (e.g., `Type | null`)
- Support for readonly properties
- Support for DateTime conversion to string
- JSDoc comment preservation from PHP docblocks
- CLI command for batch generation
- `--with-dependencies` flag to generate all dependent types
- Comprehensive test suite with PHPUnit
- Snapshot testing for generated TypeScript
- Full documentation and examples

### Features
- **ClassAnalyzer**: Reflection-based PHP class analysis
- **TypeMapper**: Intelligent PHP to TypeScript type mapping
- **TypeScriptGenerator**: Twig-based TypeScript code generation
- **CLI Tool**: Symfony Console-based command-line interface

### Type Mappings
- `string` → `string`
- `int`, `float` → `number`
- `bool` → `boolean`
- `array` → `any[]` or typed arrays
- `DateTime*` → `string`
- `mixed` → `any`
- Custom classes → TypeScript interfaces with imports

### Requirements
- PHP 8.1 or higher
- Composer for dependency management
